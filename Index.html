<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vinmonopolet Inventory Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        background: linear-gradient(135deg, #8B0000 0%, #DC143C 100%);
        min-height: 100vh;
        padding: 20px;
    }

    .container {
        max-width: 1400px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        overflow: hidden;
    }

    header {
        background: linear-gradient(135deg, #8B0000 0%, #DC143C 100%);
        color: white;
        padding: 30px;
        text-align: center;
    }

    h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
    }

    .subtitle {
        opacity: 0.9;
        font-size: 1.1em;
    }

    .controls {
        padding: 30px;
        background: #f8f9fa;
        border-bottom: 2px solid #e9ecef;
    }

    .search-bar {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }

    input[type="text"] {
        flex: 1;
        min-width: 250px;
        padding: 12px 20px;
        border: 2px solid #dee2e6;
        border-radius: 10px;
        font-size: 16px;
        transition: all 0.3s;
    }

    input[type="text"]:focus {
        outline: none;
        border-color: #8B0000;
        box-shadow: 0 0 0 3px rgba(139, 0, 0, 0.1);
    }

    .btn {
        padding: 12px 30px;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
    }

    .btn-primary {
        background: linear-gradient(135deg, #8B0000 0%, #DC143C 100%);
        color: white;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(139, 0, 0, 0.4);
    }

    .btn-secondary {
        background: #6c757d;
        color: white;
    }

    .btn-secondary:hover {
        background: #5a6268;
    }

    .filter-section {
        margin-bottom: 20px;
    }

    .filter-section h3 {
        margin-bottom: 10px;
        color: #2c3e50;
        font-size: 1.1em;
    }

    .filter-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .filter-btn {
        padding: 8px 20px;
        border: 2px solid #8B0000;
        background: white;
        color: #8B0000;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s;
        font-weight: 600;
    }

    .filter-btn:hover, .filter-btn.active {
        background: #8B0000;
        color: white;
    }

    .stats {
        display: flex;
        gap: 20px;
        margin-top: 20px;
        flex-wrap: wrap;
    }

    .stat-card {
        flex: 1;
        min-width: 150px;
        padding: 20px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .stat-number {
        font-size: 2em;
        font-weight: bold;
        color: #8B0000;
    }

    .stat-label {
        color: #6c757d;
        margin-top: 5px;
    }

    .wine-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        padding: 30px;
        min-height: 400px;
    }

    .wine-card {
        background: white;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        transition: all 0.3s;
        cursor: pointer;
        border: 2px solid transparent;
        display: flex;
        gap: 15px;
    }

    .wine-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        border-color: #8B0000;
    }

    .wine-card.favorite {
        border-color: #ffc107;
        background: linear-gradient(135deg, #fff9e6 0%, #ffffff 100%);
    }

    .wine-image {
        width: 80px;
        height: 120px;
        object-fit: contain;
        flex-shrink: 0;
        background: #f8f9fa;
        border-radius: 8px;
    }

    .wine-info {
        flex: 1;
    }

    .wine-name {
        font-size: 1.1em;
        font-weight: bold;
        margin-bottom: 8px;
        color: #2c3e50;
    }

    .wine-details {
        font-size: 0.9em;
        color: #6c757d;
        margin-bottom: 5px;
    }

    .wine-price {
        font-size: 1.2em;
        font-weight: bold;
        color: #8B0000;
        margin-top: 10px;
    }

    .wine-stock {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 0.85em;
        font-weight: 600;
        margin-top: 8px;
    }

    .stock-available {
        background: #d4edda;
        color: #155724;
    }

    .stock-order {
        background: #fff3cd;
        color: #856404;
    }

    .stock-unavailable {
        background: #f8d7da;
        color: #721c24;
    }

    .favorite-btn {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        transition: transform 0.3s;
        position: absolute;
        top: 10px;
        right: 10px;
    }

    .wine-card {
        position: relative;
    }

    .favorite-btn:hover {
        transform: scale(1.2);
    }

    .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
        padding: 20px;
        background: #f8f9fa;
    }

    .page-btn {
        padding: 8px 16px;
        border: 2px solid #8B0000;
        background: white;
        color: #8B0000;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
    }

    .page-btn:hover:not(:disabled) {
        background: #8B0000;
        color: white;
    }

    .page-btn:disabled {
        opacity: 0.3;
        cursor: not-allowed;
    }

    .page-btn.active {
        background: #8B0000;
        color: white;
    }

    .page-info {
        padding: 8px 16px;
        color: #6c757d;
        font-weight: 600;
    }

    .loading {
        text-align: center;
        padding: 50px;
        font-size: 1.5em;
        color: #8B0000;
    }

    .loading::after {
        content: '...';
        animation: dots 1.5s steps(4, end) infinite;
    }

    @keyframes dots {
        0%, 20% { content: '.'; }
        40% { content: '..'; }
        60%, 100% { content: '...'; }
    }

    .progress-bar {
        width: 100%;
        height: 30px;
        background: #e9ecef;
        border-radius: 15px;
        overflow: hidden;
        margin-top: 20px;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(135deg, #8B0000 0%, #DC143C 100%);
        transition: width 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
    }

    .error {
        background: #f8d7da;
        color: #721c24;
        padding: 15px;
        border-radius: 10px;
        margin: 20px 30px;
    }

    .empty-state {
        text-align: center;
        padding: 60px 30px;
        color: #6c757d;
    }

    .empty-state h2 {
        font-size: 2em;
        margin-bottom: 10px;
    }

    .type-filters {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-bottom: 15px;
    }

    .type-checkbox {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        background: white;
        border: 2px solid #dee2e6;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s;
    }

    .type-checkbox:hover {
        border-color: #8B0000;
    }

    .type-checkbox input[type="checkbox"] {
        cursor: pointer;
    }

    .type-checkbox.checked {
        background: #8B0000;
        color: white;
        border-color: #8B0000;
    }
</style>
```

</head>
<body>
    <div class="container">
        <header>
            <h1>üç∑ Vinmonopolet Inventory</h1>
            <p class="subtitle">Complete product catalogue - 62,890 products</p>
        </header>

```
    <div class="controls">
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Search by name, product ID, or vintage...">
            <button class="btn btn-primary" onclick="updateFromAPI()">Update from API</button>
            <button class="btn btn-secondary" onclick="showProductTypes()">Debug: Show Product Types</button>
        </div>

        <div class="filter-section">
            <h3>Product Types</h3>
            <div class="type-filters" id="typeFilters">
                <label class="type-checkbox">
                    <input type="checkbox" value="R√∏dvin" checked onchange="applyFilters()">
                    <span>üç∑ Red Wine</span>
                </label>
                <label class="type-checkbox">
                    <input type="checkbox" value="Hvitvin" checked onchange="applyFilters()">
                    <span>ü•Ç White Wine</span>
                </label>
                <label class="type-checkbox">
                    <input type="checkbox" value="Musserende vin" checked onchange="applyFilters()">
                    <span>üçæ Sparkling Wine</span>
                </label>
                <label class="type-checkbox">
                    <input type="checkbox" value="Ros√©vin" onchange="applyFilters()">
                    <span>üå∏ Ros√©</span>
                </label>
                <label class="type-checkbox">
                    <input type="checkbox" value="Brennevin" onchange="applyFilters()">
                    <span>ü•É Spirits</span>
                </label>
                <label class="type-checkbox">
                    <input type="checkbox" value="√òl" onchange="applyFilters()">
                    <span>üç∫ Beer</span>
                </label>
            </div>
        </div>

        <div class="filter-buttons">
            <button class="filter-btn active" onclick="filterWines('all')">All Products</button>
            <button class="filter-btn" onclick="filterWines('favorites')">‚≠ê Favorites</button>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalWines">0</div>
                <div class="stat-label">Total Products</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="filteredCount">0</div>
                <div class="stat-label">Filtered Results</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="favoriteCount">0</div>
                <div class="stat-label">Favorites</div>
            </div>
        </div>

        <div id="progressContainer" style="display: none;">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill">0%</div>
            </div>
        </div>
    </div>

    <div id="wineContainer" class="wine-grid"></div>
    
    <div class="pagination" id="pagination"></div>
</div>

<script>
    let allWines = [];
    let filteredWines = [];
    let favorites = new Set(JSON.parse(localStorage.getItem('favorites') || '[]'));
    let currentFilter = 'all';
    let currentPage = 1;
    const itemsPerPage = 50;

    // Load wines from localStorage on page load
    window.addEventListener('DOMContentLoaded', () => {
        loadWinesFromStorage();
        updateTypeCheckboxes();
    });

    function loadWinesFromStorage() {
        const stored = localStorage.getItem('wines');
        if (stored) {
            allWines = JSON.parse(stored);
            applyFilters();
            updateStats();
        }
    }

    function saveWinesToStorage() {
        localStorage.setItem('wines', JSON.stringify(allWines));
    }

    function updateTypeCheckboxes() {
        document.querySelectorAll('.type-checkbox input[type="checkbox"]').forEach(checkbox => {
            const label = checkbox.closest('.type-checkbox');
            if (checkbox.checked) {
                label.classList.add('checked');
            } else {
                label.classList.remove('checked');
            }
        });
    }

    function getSelectedTypes() {
        const checkboxes = document.querySelectorAll('.type-checkbox input[type="checkbox"]:checked');
        return Array.from(checkboxes).map(cb => cb.value);
    }

    function applyFilters() {
        updateTypeCheckboxes();
        
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const selectedTypes = getSelectedTypes();

        filteredWines = allWines.filter(wine => {
            // Search filter
            const matchesSearch = !searchTerm || 
                wine.productShortName.toLowerCase().includes(searchTerm) ||
                wine.productId.toString().includes(searchTerm) ||
                (wine.vintage && wine.vintage.toString().includes(searchTerm));

            // Type filter - if no types selected, show all
            let matchesType = selectedTypes.length === 0;
            
            if (!matchesType && wine.productType) {
                const productTypeLower = wine.productType.toLowerCase();
                
                matchesType = selectedTypes.some(type => {
                    switch(type) {
                        case 'R√∏dvin':
                            return productTypeLower.includes('r√∏d') || productTypeLower.includes('red');
                        case 'Hvitvin':
                            return productTypeLower.includes('hvit') || productTypeLower.includes('white');
                        case 'Musserende vin':
                            return productTypeLower.includes('musserende') || 
                                   productTypeLower.includes('sparkling') || 
                                   productTypeLower.includes('champagne') ||
                                   productTypeLower.includes('cava') ||
                                   productTypeLower.includes('prosecco');
                        case 'Ros√©vin':
                            return productTypeLower.includes('ros√©') || productTypeLower.includes('rose');
                        case 'Brennevin':
                            return productTypeLower.includes('brennevin') || 
                                   productTypeLower.includes('spirits') ||
                                   productTypeLower.includes('akevitt') ||
                                   productTypeLower.includes('whisky') ||
                                   productTypeLower.includes('vodka') ||
                                   productTypeLower.includes('gin') ||
                                   productTypeLower.includes('rom') ||
                                   productTypeLower.includes('cognac');
                        case '√òl':
                            return productTypeLower.includes('√∏l') || productTypeLower.includes('beer');
                        default:
                            return productTypeLower.includes(type.toLowerCase());
                    }
                });
            }

            // Favorites filter
            const matchesFavorites = currentFilter === 'all' || 
                (currentFilter === 'favorites' && favorites.has(wine.productId));

            return matchesSearch && matchesType && matchesFavorites;
        });

        currentPage = 1;
        displayWines();
        updateStats();
    }

    function displayWines() {
        const container = document.getElementById('wineContainer');
        
        if (filteredWines.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <h2>No products found</h2>
                    <p>${allWines.length === 0 ? 'Click "Update from API" to load products' : 'Try adjusting your filters or search'}</p>
                </div>
            `;
            document.getElementById('pagination').innerHTML = '';
            return;
        }

        // Pagination
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        const pageWines = filteredWines.slice(startIndex, endIndex);

        container.innerHTML = pageWines.map(wine => {
            const imageUrl = wine.images && wine.images.length > 0 
                ? wine.images[0].url 
                : 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="80" height="120" viewBox="0 0 80 120"%3E%3Crect fill="%23f0f0f0" width="80" height="120"/%3E%3Ctext x="50%25" y="50%25" dominant-baseline="middle" text-anchor="middle" font-family="sans-serif" font-size="14" fill="%23999"%3ENo Image%3C/text%3E%3C/svg%3E';
            
            const stockStatus = wine.buyable ? 'available' : (wine.productAvailability === 'availableForOrder' ? 'order' : 'unavailable');
            const stockText = wine.buyable ? 'In Stock' : (wine.productAvailability === 'availableForOrder' ? 'Order Only' : 'Unavailable');

            return `
                <div class="wine-card ${favorites.has(wine.productId) ? 'favorite' : ''}">
                    <img src="${imageUrl}" alt="${wine.productShortName}" class="wine-image" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'80\\' height=\\'120\\'%3E%3Crect fill=\\'%23f0f0f0\\' width=\\'80\\' height=\\'120\\'/%3E%3C/svg%3E'">
                    <div class="wine-info">
                        <div class="wine-name">${wine.productShortName}</div>
                        <div class="wine-details">ID: ${wine.productId}</div>
                        ${wine.productType ? `<div class="wine-details">${wine.productType}</div>` : ''}
                        ${wine.volume ? `<div class="wine-details">Volume: ${wine.volume}L</div>` : ''}
                        ${wine.vintage ? `<div class="wine-details">Vintage: ${wine.vintage}</div>` : ''}
                        ${wine.price ? `<div class="wine-price">${wine.price} kr</div>` : ''}
                        <span class="wine-stock stock-${stockStatus}">${stockText}</span>
                    </div>
                    <button class="favorite-btn" onclick="toggleFavorite(${wine.productId}, event)">
                        ${favorites.has(wine.productId) ? '‚≠ê' : '‚òÜ'}
                    </button>
                </div>
            `;
        }).join('');

        renderPagination();
    }

    function renderPagination() {
        const totalPages = Math.ceil(filteredWines.length / itemsPerPage);
        const paginationContainer = document.getElementById('pagination');

        if (totalPages <= 1) {
            paginationContainer.innerHTML = '';
            return;
        }

        let paginationHTML = `
            <button class="page-btn" onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>‚Üê Previous</button>
        `;

        // Show first page
        if (currentPage > 3) {
            paginationHTML += `<button class="page-btn" onclick="changePage(1)">1</button>`;
            if (currentPage > 4) {
                paginationHTML += `<span class="page-info">...</span>`;
            }
        }

        // Show pages around current
        for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) {
            paginationHTML += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">${i}</button>`;
        }

        // Show last page
        if (currentPage < totalPages - 2) {
            if (currentPage < totalPages - 3) {
                paginationHTML += `<span class="page-info">...</span>`;
            }
            paginationHTML += `<button class="page-btn" onclick="changePage(${totalPages})">${totalPages}</button>`;
        }

        paginationHTML += `
            <button class="page-btn" onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>Next ‚Üí</button>
            <span class="page-info">Page ${currentPage} of ${totalPages}</span>
        `;

        paginationContainer.innerHTML = paginationHTML;
    }

    function changePage(page) {
        const totalPages = Math.ceil(filteredWines.length / itemsPerPage);
        if (page < 1 || page > totalPages) return;
        
        currentPage = page;
        displayWines();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function toggleFavorite(productId, event) {
        event.stopPropagation();
        
        if (favorites.has(productId)) {
            favorites.delete(productId);
        } else {
            favorites.add(productId);
        }

        localStorage.setItem('favorites', JSON.stringify([...favorites]));
        displayWines();
        updateStats();
    }

    function filterWines(filter) {
        currentFilter = filter;
        
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');

        applyFilters();
    }

    function updateStats() {
        document.getElementById('totalWines').textContent = allWines.length.toLocaleString();
        document.getElementById('filteredCount').textContent = filteredWines.length.toLocaleString();
        document.getElementById('favoriteCount').textContent = favorites.size;
    }

    // Search functionality with debouncing
    let searchTimeout;
    document.getElementById('searchInput').addEventListener('input', () => {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
            applyFilters();
        }, 300);
    });

    function showProductTypes() {
        const types = [...new Set(allWines.map(p => p.productType))].filter(t => t).sort();
        const typeCounts = {};
        allWines.forEach(wine => {
            if (wine.productType) {
                typeCounts[wine.productType] = (typeCounts[wine.productType] || 0) + 1;
            }
        });
        
        console.log('=== PRODUCT TYPES IN YOUR DATA ===');
        console.log('Unique types:', types);
        console.log('\nCounts by type:');
        Object.entries(typeCounts)
            .sort((a, b) => b[1] - a[1])
            .forEach(([type, count]) => {
                console.log(`${type}: ${count} products`);
            });
        
        alert(`Found ${types.length} unique product types. Check the console (F12) for details.`);
    }

    async function updateFromAPI() {
        const btn = event.target;
        btn.disabled = true;
        btn.textContent = 'Updating...';
        
        const progressContainer = document.getElementById('progressContainer');
        const progressFill = document.getElementById('progressFill');
        progressContainer.style.display = 'block';

        allWines = [];
        const API_KEY = 'c53c9b559f824a80b3a94b9d565ecaaa';
        const BASE_URL = 'https://apis.vinmonopolet.no/products/v0/details-normal';
        
        let start = 0;
        const maxResults = 1000;
        let hasMore = true;

        try {
            while (hasMore) {
                progressFill.textContent = `Loading products... (${allWines.length} loaded so far)`;
                
                const url = `${BASE_URL}?maxResults=${maxResults}&start=${start}`;
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Ocp-Apim-Subscription-Key': API_KEY,
                        'Accept': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log(`Fetched batch starting at ${start}:`, data);
                
                if (data && Array.isArray(data) && data.length > 0) {
                    const processedProducts = data.map(product => ({
                        productId: product.productId || product.id,
                        productShortName: product.productShortName || product.name || 'Unknown Product',
                        price: product.price,
                        volume: product.volume,
                        productType: product.mainProductType || product.productType,
                        vintage: product.vintage,
                        images: product.images || [],
                        buyable: product.buyable,
                        productAvailability: product.productAvailability
                    }));
                    
                    allWines = [...allWines, ...processedProducts];
                    
                    const progress = Math.min(95, (allWines.length / 70000) * 100);
                    progressFill.style.width = progress + '%';
                    progressFill.textContent = `${allWines.length} products loaded...`;
                    
                    console.log(`Total products loaded: ${allWines.length}`);
                    
                    if (data.length < maxResults) {
                        hasMore = false;
                    } else {
                        start += maxResults;
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                } else {
                    hasMore = false;
                }
            }

            progressFill.style.width = '100%';
            progressFill.textContent = `Complete! ${allWines.length} products loaded from Vinmonopolet`;
            saveWinesToStorage();
            applyFilters();
            updateStats();
            
            setTimeout(() => {
                progressContainer.style.display = 'none';
                btn.disabled = false;
                btn.textContent = 'Update from API';
            }, 2000);

        } catch (error) {
            console.error('Error fetching products:', error);
            document.getElementById('wineContainer').innerHTML = `
                <div class="error">
                    Error loading products from Vinmonopolet: ${error.message}
                    <br><br>
                    <strong>Debug info:</strong> Check the browser console for more details.
                    <br>Please try again later.
                </div>
            `;
            progressContainer.style.display = 'none';
            btn.disabled = false;
            btn.textContent = 'Update from API';
        }
    }
</script>
```

</body>
</html>
